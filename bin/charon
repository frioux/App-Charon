#!/usr/bin/env perl

use strict;
use warnings;

use IO::Async::Loop;
use Net::Async::HTTP::Server::PSGI;

use App::Charon::Web;

my $loop = IO::Async::Loop->new;

my $quit = $loop->new_future;

my $handler = Net::Async::HTTP::Server::PSGI->new(
   app => App::Charon::Web->new( quit => $quit )->to_psgi_app,
);
$loop->add($handler);

$handler->listen(
   host => '0.0.0.0',
   service => '5002',
   socktype => 'stream',
   on_listen_error => sub { die $_[0] },
   on_resolve_error => sub { die $_[0] },
);

warn "listening on 0.0.0.0:5002\n";

$quit->get;
